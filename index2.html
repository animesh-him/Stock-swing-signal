<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Indian Stocks Swing Trade Analyzer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js">// --- Added RSI ---
function rsi(data, period=14){
  let gains=[], losses=[];
  for(let i=1;i<data.length;i++){
    let diff = data[i]-data[i-1];
    gains.push(diff>0?diff:0);
    losses.push(diff<0?Math.abs(diff):0);
  }
  let avgGain = gains.slice(0,period).reduce((a,b)=>a+b)/period;
  let avgLoss = losses.slice(0,period).reduce((a,b)=>a+b)/period;
  let rsiArr=[50];
  for(let i=period;i<gains.length;i++){
    avgGain = (avgGain*(period-1)+gains[i])/period;
    avgLoss = (avgLoss*(period-1)+losses[i])/period;
    let rs = avgGain/avgLoss;
    rsiArr.push(100 - (100/(1+rs)));
  }
  while(rsiArr.length<data.length) rsiArr.unshift(null);
  return rsiArr;
}// --- Added MACD --- function macd(data){ const ema12 = ema(data,12); const ema26 = ema(data,26); const macdLine = ema12.map((v,i)=>v-ema26[i]); const signal = ema(macdLine,9); return {macdLine, signal}; }

// --- ATR Stoploss Trail --- function atrStop(prices, atr, multiplier=2) { return prices.map((p,i)=> atr[i] ? p - atr[i]*multiplier : null); }

// --- Volume Spike --- function volumeSpike(vol, mult=1.5){ let avg = vol.reduce((a,b)=>a+b)/vol.length; return vol.map(v => v > avg*mult ? v : null); }

// --- Risk Reward Projection --- function rrTargets(price, atr){ return { t1: price + atr1, t2: price + atr2, sl: price - atr*1 }; }

async function analyze(){ const symbol = document.getElementById('stockSelect').value; const raw = await fetchData(symbol); const prices = raw.chart.result[0].indicators.quote[0].close; const times = raw.chart.result[0].timestamp.map(t=>new Date(t*1000).toLocaleDateString()); const ema21 = ema(prices,21); const ema50 = ema(prices,50); const rsiData = rsi(prices); const {macdLine, signal} = macd(prices);

// Auto buy/sell logic let markers = prices.map((p,i)=>{ if(i>0 && ema21[i]>ema50[i] && prices[i]>ema21[i] && prices[i-1]<ema21[i-1]) return "BUY"; if(i>0 && ema21[i]<ema50[i] && prices[i]<ema21[i] && prices[i-1]>ema21[i-1]) return "SELL"; return ""; });

if(chart) chart.destroy(); chart = new Chart(document.getElementById('chart'),{ type:"line", data:{ labels: times, datasets:[ {label:"Price", data: prices, borderWidth:2}, {label:"EMA21", data:ema21, borderWidth:1}, {label:"EMA50", data:ema50, borderWidth:1}, {label:"RSI (overlay)", data:rsiData, borderWidth:1}, {label:"MACD", data:macdLine, borderWidth:1}, {label:"Signal", data:signal, borderWidth:1}, {label:"Markers", data:markers.map(m=>m=="BUY"?prices[markers.indexOf(m)]:null), pointRadius:5} ]}, options:{ responsive:true } }); } // --- Advanced Mode Additions --- // Bollinger Bands function bollinger(data, period=20, mult=2){ let sma=[], upper=[], lower=[]; for(let i=0;i<data.length;i++){ if(i<period) {sma.push(null); upper.push(null); lower.push(null); continue;} let slice=data.slice(i-period,i); let avg=slice.reduce((a,b)=>a+b)/period; let std=Math.sqrt(slice.map(v=>Math.pow(v-avg,2)).reduce((a,b)=>a+b)/period); sma.push(avg); upper.push(avg+multstd); lower.push(avg-multstd); } return {sma,upper,lower}; }

// ATR for stop loss function atr(high,low,close,period=14){ let tr=[], atr=[]; for(let i=1;i<close.length;i++){ tr.push(Math.max(high[i]-low[i], Math.abs(high[i]-close[i-1]), Math.abs(low[i]-close[i-1]))); } let avg = tr.slice(0,period).reduce((a,b)=>a+b)/period; atr.push(avg); for(let i=period;i<tr.length;i++){ avg = (avg*(period-1)+tr[i])/period; atr.push(avg); } while(atr.length<close.length) atr.unshift(null); return atr; }

async function analyze(){ const symbol = document.getElementById('stockSelect').value; const raw = await fetchData(symbol); const q = raw.chart.result[0].indicators.quote[0]; const prices = q.close; const highs = q.high; const lows = q.low; const times = raw.chart.result[0].timestamp.map(t=>new Date(t*1000).toLocaleDateString()); const ema21 = ema(prices,21); const ema50 = ema(prices,50); const rsiData = rsi(prices); const {macdLine, signal} = macd(prices); const bb = bollinger(prices); const atrData = atr(highs,lows,prices);

let markers = prices.map((p,i)=>{ if(i>0 && ema21[i]>ema50[i] && prices[i]>ema21[i] && prices[i-1]<ema21[i-1]) return "BUY"; if(i>0 && ema21[i]<ema50[i] && prices[i]<ema21[i] && prices[i-1]>ema21[i-1]) return "SELL"; return ""; });

if(chart) chart.destroy(); chart = new Chart(document.getElementById('chart'),{ type:"line", data:{ labels: times, datasets:[ {label:"Price", data: prices, borderWidth:2}, {label:"EMA21", data:ema21, borderWidth:1}, {label:"EMA50", data:ema50, borderWidth:1}, {label:"RSI (overlay)", data:rsiData, borderWidth:1}, {label:"MACD", data:macdLine, borderWidth:1}, {label:"Signal", data:signal, borderWidth:1}, {label:"BB Upper", data:bb.upper, borderWidth:1}, {label:"BB Lower", data:bb.lower, borderWidth:1}, {label:"ATR", data:atrData, borderWidth:1} ]}, options:{ responsive:true } }); } </script>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select, button { padding: 8px; margin: 5px; }
    #chartContainer { width: 100%; max-width: 1200px; }
  </style></head>
<body>
  <h2>Indian Swing Trading Analyzer (Autoâ€‘Updated Data)</h2>
  <select id="stockSelect"></select>
  <button onclick="analyze()">Analyze</button>  <div id="chartContainer">
    <canvas id="chart"></canvas>
  </div><script>
const stocks = ["TATASTEEL.NS", "ONGC.NS", "TATAMOTORS.NS", "CDSL.NS", "RELIANCE.NS", "HDFCBANK.NS", "INFY.NS", "BHARTIARTL.NS", "ICICIBANK.NS", "ADANIPORTS.NS", "POWERGRID.NS"];

window.onload = () => {
  const sel = document.getElementById('stockSelect');
  stocks.forEach(s => {
    let opt = document.createElement('option');
    opt.value = s; opt.innerText = s.replace(".NS", "");
    if (s === "TATASTEEL.NS") opt.style.fontWeight = "bold";
    sel.appendChild(opt);
  });
  sel.value = "TATASTEEL.NS";
  analyze();(opt); if (opt.value === "TATASTEEL.NS") sel.value = "TATASTEEL.NS";(opt);
  });
}

async function fetchData(symbol){
  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=6mo&interval=1d`;
  const res = await fetch(url);
  return await res.json();
}

function ema(data, period) {
  const k = 2/(period+1);
  let emaArr=[data[0]];
  for(let i=1;i<data.length;i++){
    emaArr.push(data[i]*k + emaArr[i-1]*(1-k));
  }
  return emaArr;
}

let chart;
async function analyze(){
  const symbol = document.getElementById('stockSelect').value;
  const raw = await fetchData(symbol);
  const prices = raw.chart.result[0].indicators.quote[0].close;
  const times = raw.chart.result[0].timestamp.map(t=>new Date(t*1000).toLocaleDateString());
  const ema21 = ema(prices,21);
  const ema50 = ema(prices,50);

  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('chart'),{
    type:"line",
    data:{ labels: times, datasets:[
      {label:"Price", data: prices, borderWidth:2},
      {label:"EMA21", data:ema21, borderWidth:1},
      {label:"EMA50", data:ema50, borderWidth:1}
    ]},
    options:{ responsive:true }
  });
}
</script></body>
</html>
